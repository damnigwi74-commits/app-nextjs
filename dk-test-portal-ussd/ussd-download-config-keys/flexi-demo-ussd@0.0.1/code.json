{
    "login_mapper": "\r\n\tlet obj = arguments [ 0 ].data;\r\n\tif ( obj.response.response_code === '01' ) {\r\n\t\treturn {\r\n\t\t\tstatus : \"failed\"\r\n\t\t}\r\n\r\n\t}\r\n\tif ( obj.response.response_code === '00' ) {\r\n\t\treturn {\r\n\t\t\tstatus : \"success\",\r\n\t\t\tmessage : {\r\n\t\t\t\taccess_token: obj.data.access_token\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n",
    "crypt_hash": {
        "hash": "\n\t\t\t\tlet passwordHash       = arguments [ 2 ].HmacSHA256 ( arguments [ 0 ], arguments [ 1 ] )\n\t\t\t\tlet passwordHashBase64 = arguments [ 2 ].enc.Base64.stringify ( passwordHash )\n\n\t\t\t\treturn passwordHashBase64\n\t\t\t",
        "encrypt": "\n\t\t\t\tlet secretKey \t\t= arguments [ 1 ]\t\n\t\t\t\tlet encryptionKey \t= secretKey.substr ( 0, 16 )\n\t\t\t\tlet iv_ \t\t\t= secretKey.substr ( secretKey.length - 16 )\n\t\t\t\tlet key\t\t\t\t= arguments [ 2 ].enc.Utf8.parse ( encryptionKey )\n\t\t\t\tlet key_iv\t\t    = arguments [ 2 ].enc.Utf8.parse ( iv_ )\n\t\t\t\tlet plaintext\t\t= arguments [ 2 ].enc.Utf8.parse ( JSON.stringify ( arguments [ 0 ] ) )\n\t\t\t\tlet ciphertext      = arguments [ 2 ].AES.encrypt(\n\t\t\t\t\tplaintext,\n\t\t\t\t\tkey,\n\t\t\t\t\t{\n\t\t\t\t\t\tiv     : key_iv,\n\t\t\t\t\t\tmode   : arguments [ 2 ].mode.CBC,\n\t\t\t\t\t\tpadding: arguments [ 2 ].pad.Pkcs7\n\t\t\t\t\t}\n\t\t\t\t).ciphertext.toString ( arguments [ 2 ].enc.Base64 )\n\n\t\t\t\treturn ciphertext\n\t\t\t",
        "decrypt": "\n\t\t\t\tlet secretKey       = arguments [ 1 ]\n\t\t\t\tlet encryptionKey \t= secretKey.substr ( 0, 16 )\n\t\t\t\tlet iv_ \t\t\t= secretKey.substr ( secretKey.length - 16 )\n\t\t\t\tlet key\t\t\t\t= arguments [ 2 ].enc.Utf8.parse ( encryptionKey )\n\t\t\t\tlet key_iv\t\t    = arguments [ 2 ].enc.Utf8.parse ( iv_ )\n\n\t\t\t\tlet bytes = arguments [ 2 ].AES.decrypt ( \n\t\t\t\t\targuments [ 0 ].toString ( arguments [ 2 ].enc.Utf8 ), \n\t\t\t\t\tkey, \n\t\t\t\t\t{\n\t\t\t\t\t\tiv     : key_iv,\n\t\t\t\t\t\tmode   : arguments [ 2 ].mode.CBC,\n\t\t\t\t\t\tpadding: arguments [ 2 ].pad.Pkcs7\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\n\t\t\t\tlet originalText = arguments [ 2 ].enc.Utf8.stringify ( bytes ).toString( 'utf-8' ) \n\t\t\t\n\t\t\t\treturn JSON.parse ( originalText )\n\t\t\t"
    },
    "reset_pin_trials": "return 3",
    "profile_mapper": "\r\n\t\tlet obj = arguments [ 0 ].data;\r\n\r\n\t\t//transaction failed\r\n\t\tif ( obj.response.response_code  === '05' ) {\r\n\t\t\treturn {\r\n\t\t\t\tstatus: 'failed',\r\n\t\t\t\tmessage: \"The profile request failed\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//account suspended\r\n\t\telse if ( \r\n\t\t\tobj.response.response_code  === '01' && \r\n\t\t\tObject.keys ( obj.data ).length === 0  &&\r\n\t\t\tobj.response.response.includes ( 'suspended' ) \r\n\t\t) {\r\n\t\t\t//user profile data \r\n\t\t\tlet profile = {\r\n\t\t\t\t\"account-details\"                : {        \r\n\t\t\t\t\t\"account-type\"               : \"client\",\r\n\t\t\t\t\t\"is-registered\"              : true,\r\n\t\t\t\t\t\"is-blocked\"                 : true,\r\n\t\t\t\t\t\"first-login\"                : false\r\n\t\t\t\t},\r\n\t\t\t\t\"app_contact_name\" : \"Maisha Bora Support\",\r\n\t\t\t\t\"app_contact_number\" : \"254 729 347 882\",\r\n\t\t\t\t\"app_email\" : \"support@maishabora.com\",\t\t\t\t\r\n\t\t\t\t\"shortcode\"                      : \"*673*1#\",\r\n\t\t\t\t\"app_description\"                : \"SC Bank USSD\",\t\t\t\t\r\n\t\t\t\t\"terms_url\"                      : \"info@maishabora.com\",\r\n\t\t\t\t\"app_name\"                       : \"mobile-banking-ussd@0.0.1\",\r\n\t\t\t\t\"language\"                       : \"english\",\r\n\t\t\t\t\"msisdn\"                         : arguments [ 0 ].msisdn,\r\n\t\t\t\t\"pin-trials-remaining\"           : 3 ,  \r\n\t\t\t\t\"global-constants\"               : {\r\n\t\t\t\t\t\"funds_transfer_minimum\"     : 50,\r\n\t\t\t\t\t\"airtime_topup_minimum\"      : 10,\r\n\t\t\t\t\t\"language-options\"           : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"english-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"english\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"swahili-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"swahili\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\t\"yes-no-options\"             : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"yes-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"1\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"no-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"2\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\t\"confirm-options\"            : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"confirm-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"1\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"cancel-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"2\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t\"global-request-details\"        : {}\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tstatus: 'success',\r\n\t\t\t\tmessage: profile\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//not registered\r\n\t\telse if ( \r\n\t\t\tobj.response.response_code  === '01' && \r\n\t\t\tObject.keys ( obj.data ).length === 0 \r\n\t\t) {\r\n\t\t\t//user profile data \r\n\t\t\tlet profile = {\r\n\t\t\t\t\"account-details\"                : {        \r\n\t\t\t\t\t\"account-type\"               : \"client\",\r\n\t\t\t\t\t\"is-registered\"              : false,\r\n\t\t\t\t\t\"is-blocked\"                 : false,\r\n\t\t\t\t\t\"first-login\"                : false\r\n\t\t\t\t},\r\n\t\t\t\t\"app_description\"                : \"SC Bank USSD\",\r\n\t\t\t\t\"app_name\"                       : \"mobile-banking-ussd@0.0.1\",\t\t\t\t\r\n\t\t\t\t\"shortcode\"                      : \"*605*52#\",\r\n\t\t\t\t\"language\"                       : \"english\",\t\t\t\t\r\n\t\t\t\t\"terms_url\"                      : \"info@maishabora.com\",\r\n\t\t\t\t\"msisdn\"                         : arguments [ 0 ].msisdn,\r\n\t\t\t\t\"pin-trials-remaining\"           : 3 ,  \r\n\t\t\t\t\"global-constants\"               : {\r\n\t\t\t\t\t\"funds_transfer_minimum\"     : 50,\r\n\t\t\t\t\t\"airtime_topup_minimum\"      : 10,\r\n\t\t\t\t\t\"language-options\"           : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"english-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"english\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"swahili-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"swahili\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\t\"yes-no-options\"             : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"yes-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"1\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"no-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"2\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\t\"confirm-options\"            : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"confirm-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"1\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"cancel-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"2\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t\"global-request-details\"        : {}\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tstatus: 'success',\r\n\t\t\t\tmessage: profile\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//registered\r\n\t\telse if ( obj.response.response_code  === '00') {\r\n\t\t\tconsole.log ( \"Processing Object\")\r\n\t\t\t//response mapping to standard USSD Sidian Express format:\r\n\t\t\tlet accountType    = 'client';\r\n\t\t\tlet firstLogin     = false;\r\n\t\t\tlet isRegistered   = false;\r\n\t\t\tlet isBlocked      = false;\r\n\t\t\tlet linkedAccounts = [];\r\n\r\n\t\t\tif ( Object.keys ( obj.data ).length  === 0 ) {\r\n\t\t\t\tisBlocked = true;\r\n\t\t\t}\r\n\r\n\t\t\tif ( obj.data.registered  \t\t=== '0'  ) {\r\n\t\t\t\tfirstLogin = true;\r\n\t\t\t}\r\n\t\t\tif ( obj.data.registered \t\t===  '2'  ){\r\n\t\t\t\tisBlocked = true;\r\n\t\t\t}\r\n\t\t\tif ( obj.response.response_code \t=== '00' ) {\r\n\t\t\t\tisRegistered = true;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//map accounts\r\n\t\t\tif ( obj.data.account.accounts ) {\r\n\r\n\t\t\t\tlet accounts = obj.data.account.accounts;\r\n\r\n\t\t\t\taccounts = accounts.map ( ( account) => {\r\n\t\t\t\t\t if ( account.account_type !=='FOSA' && account.account_type !=='SAVINGS' ) {return {\r\n\t\t\t\t\t\tlabel: /** account.account_name*/'EWALLET - ' + account.account_number,\r\n\t\t\t\t\t\tvalue: account.account_number,\r\n\t\t\t\t\t\ttype : account.account_type\r\n\t\t\t\t\t}}\r\n\t\t\t\t})\r\n\r\n\t\t\t\tlinkedAccounts = accounts\r\n\t\t\t}\r\n\r\n\t\t\t//user profile data \r\n\t\t\tlet profile = {\r\n\t\t\t\t\"account-details\"                : {        \r\n\t\t\t\t\t\"account-type\"               : accountType,\r\n\t\t\t\t\t\"identification-id\"          : obj.data.account.customer_number,\r\n\t\t\t\t\t\"is-registered\"              : isRegistered,\r\n\t\t\t\t\t\"is-blocked\"                 : isBlocked,\r\n\t\t\t\t\t\"first-login\"                : firstLogin,\r\n\t\t\t\t\t\"firstname\"                  : obj.data.account.first_name,\r\n\t\t\t\t\t\"surname\"                    : obj.data.account.last_name,\r\n\t\t\t\t\t\"othername\"                  : obj.data.account.other_name || '',\r\n\t\t\t\t\t\"fullname\"                   : obj.data.account.full_name || '',\r\n\t\t\t\t\t\"active\"                     : obj.data.registered ,\r\n\t\t\t\t\t\"loan-limit\"                 : parseInt ( obj.data.loan_scored || 0,10 ) || '0',\r\n\t\t\t\t\t\"pin\"                        : obj.data.PIN || \"\",\r\n\t\t\t\t\t\"fosa-accounts\"              : linkedAccounts,  \r\n\t\t\t\t\t\"loan-accounts\"              : [],      \r\n\t\t\t\t\t\"owned-accounts\"             : [],\r\n\t\t\t\t\t\"current-loans\"              : [],\r\n\t\t\t\t\t\"search-options\"             : []\r\n\t\t\t\t},\r\n\t\t\t\t\"app_contact_name\" \t\t\t\t : \"Maisha Bora Support\",\r\n\t\t\t\t\"app_contact_number\" \t\t\t : \"254 729 347 882\",\r\n\t\t\t\t\"shortcode\"                      : \"*605*71#\",\r\n\t\t\t\t\"app_email\" \t\t\t\t\t : \"support@maishabora.com\",\r\n\t\t\t\t\"app_description\"                : \"SC Bank USSD\",\r\n\t\t\t\t\"app_name\"                       : \"mobile-banking-ussd@0.0.1\",\r\n\t\t\t\t\"language\"                       : \"english\",\r\n\t\t\t\t\"currency_code\"                  : \"KES\",\r\n\t\t\t\t\"terms_url\"                      : \"info@maishabora.com\",\r\n\t\t\t\t\"msisdn\"                         : obj.data.account.username,\r\n\t\t\t\t\"email\"                          : obj.data.account.email_address,\r\n\t\t\t\t\"pin-trials-remaining\"           : 3 - parseInt ( obj.data.account.login_trials || 0, 10 ) ,  \r\n\t\t\t\t\"global-constants\"               : {\r\n\t\t\t\t\t\"funds_transfer_minimum\"     : 50,\r\n\t\t\t\t\t\"minimum-billpayment-amount\" : 200,\r\n\t\t\t\t\t\"minimum-airtime-amount\"     : 10,\r\n\t\t\t\t\t\"airtime_topup_minimum\"      : 10,\r\n\t\t\t\t\t\"language-options\"           : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"english-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"english\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"swahili-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"swahili\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\t\"yes-no-options\"             : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"yes-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"1\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"no-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"2\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\t\"confirm-options\"            : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"confirm-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"1\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"label\"              : \"cancel-label\",\r\n\t\t\t\t\t\t\t\"value\"              : \"2\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t\"global-request-details\"        : {}\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tstatus: 'success',\r\n\t\t\t\tmessage: profile\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t",
    "decrement_pin_trials": "return parseInt ( arguments [ 0 ], 10 ) - 1"
}