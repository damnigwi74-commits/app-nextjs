[
  {
    "type": "skip",
    "name": "fetch-loan-application-cycle",
    "action": "update-parameters",
    "external-fetch": {
      "route": "fetch-loan-limit",
      "success": "loan-application-products-options",
      "error": "api-error",
      "cache": true,
      "cache-path": "global-request-details",
      "cache-parameters": [
        {
          "path": "data.cycleOpen",
          "save-as": "cycleOpen",
          "default": false
        },
        {
          "path": "data.limit",
          "save-as": "limit",
          "default": "0"
        },
        {
          "path": "data.limit",
          "save-as": "loan-amount-options",
          "format-as": "formatLoanLimitAccount"
        }
      ],
      "parameter-checks": {
        "cycleOpen": {
          "is-equal-to": true,
          "redirect-to": "loan-application-cycle-error"
        }
      }
    }
  },
  {
    "type": "select",
    "name": "loan-application-products-options",
    "save-as": "loanProductType",
    "options": [
      {
        "label": "Salary Advance Loan",
        "value": "Salary Advance Loan",
        "jump-to": "loan-application-type-options"
      },
      {
        "label": "Term Loan",
        "value": "Term Loan",
        "jump-to": "m-loan-application-type-options",
        "meta": [
          {
            "save-as": "limit",
            "cache-path": "global-request-details",
            "value": "25000"
          },
          {
            "save-as": "loan-amount-options",
            "cache-path": "global-request-details",
            "value": "25000",
            "format-as": "formatLoanLimitAccount"
          }
        ]
      }
    ],
    "options-error": "loan-application-options-error",
    "error": "loan-application-products-options-error",
    "previous": "client-page",
    "next": "loan-application-type-options"
  },
  {
    "type": "select",
    "name": "loan-application-type-options",
    "save-as": "borrowAmount",
    "format-as": "formatLoanLimitMinimumAmount",
    "options": "loan-amount-options",
    "options-error": "loan-application-options-error",
    "error": "loan-application-type-options-error",
    "previous": "loan-application-products-options",
    "next": "loan-application-payment-method"
  },
  {
    "type": "input",
    "name": "loan-application-amount",
    "save-as": "borrowAmount",
    "validation": [
      {
        "name": "isWithinLoanLimit",
        "type": "custom",
        "arguments": "min=%@minimumLoanApplication, max=%@limit"
      }
    ],
    "error": "loan-application-amount-error",
    "previous": "loan-application-type-options",
    "next": "loan-application-payment-method"
  },
  {
    "type": "select",
    "name": "loan-application-payment-method",
    "save-as": "repaymentMethod",
    "save-as-label": "repaymentMethod",
    "options": [
      {
        "label": "Mobile Money",
        "value": "Mobile Money",
        "jump-to": "loan-application-provider"
      },
      {
        "label": "Bank account",
        "value": "Bank account",
        "jump-to": "loan-application-bank-account-account"
      },
      {
        "label": "Eclectics Wallet",
        "value": "Eclectics Wallet",
        "jump-to": "loan-application-credit-account"
      }
    ],
    "next": "loan-application-confirm",
    "error": "loan-application-payment-method-error",
    "previous": "loan-application-type-options"
  },
  {
    "type": "select",
    "name": "loan-application-provider",
    "save-as": "airtimeProvider",
    "options": [
      {
        "label": "MPESA",
        "value": "MPESA"
      },
      {
        "label": "Airtel Money",
        "value": "Airtel Money"
      },
      {
        "label": "T-kash",
        "value": "T-kash"
      }
    ],
    "error": "loan-application-provider-error",
    "next": "loan-application-account-type",
    "previous": "loan-application-payment-method"
  },
  {
    "type": "select",
    "name": "loan-application-account-type",
    "save-as": "airtimeCreditAccount",
    "options": [
      {
        "label": "My Phone",
        "value": "__walletAccount",
        "jump-to": "loan-application-confirm"
      },
      {
        "label": "Other Phone",
        "jump-to": "loan-application-credit-account"
      }
    ],
    "error": "loan-application-account-type-error",
    "previous": "loan-application-provider"
  },
  {
    "type": "input",
    "name": "loan-application-credit-account",
    "save-as": "airtimeCreditAccount",
    "format-as": "international-mobile-number",
    "validation": [
      {
        "name": "matchesLength",
        "type": "joi",
        "arguments": "length=10"
      },
      {
        "name": "isNumber",
        "type": "joi"
      }
    ],
    "errors": [
      "loan-application-credit-account-error",
      "loan-application-credit-account-error"
    ],
    "previous": "loan-application-account-type",
    "next": "loan-application-confirm"
  },
  {
    "type": "select",
    "name": "loan-application-bank-account-account",
    "save-as": "bankAccount",
    "options": "savings-accounts",
    "error": "loan-application-bank-account-account-error",
    "previous": "loan-application-payment-method",
    "next": "loan-application-confirm"
  },
  {
    "type": "select",
    "name": "loan-application-confirm",
    "options": "confirm-options",
    "error": "loan-application-confirm-error",
    "action": "transact",
    "external-fetch": {
      "route": "loan-application",
      "success": "api-success",
      "error": "api-error"
    },
    "on-cancel": "client-page",
    "previous": "loan-application-type-options"
  },
  {
    "type": "select",
    "name": "loan-application-error",
    "options": "yes-no-options",
    "error": "loan-application-error-error",
    "action": "navigate",
    "on-accept": "client-page",
    "on-cancel": "logout"
  },
  {
    "type": "select",
    "name": "loan-application-limit-zero-error",
    "options": "yes-no-options",
    "error": "loan-application-limit-zero-error-error",
    "action": "navigate",
    "on-accept": "client-page",
    "on-cancel": "logout"
  },
  {
    "type": "select",
    "name": "loan-application-options-error",
    "options": "yes-no-options",
    "error": "loan-application-options-error-error",
    "action": "navigate",
    "on-accept": "client-page",
    "on-cancel": "logout"
  },
  {
    "type": "select",
    "name": "loan-application-cycle-error",
    "options": "yes-no-options",
    "error": "loan-application-cycle-error-error",
    "action": "navigate",
    "on-accept": "client-page",
    "on-cancel": "logout"
  }
]